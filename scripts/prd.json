{
  "title": "Fix Dashboard Reset to Empty State on Skip",
  "branchName": "fix/dashboard-reset-on-skip",
  "userStories": [
    {
      "id": "US-001",
      "title": "Fix double _play_next race condition in skip",
      "description": "Introduce a _skipping flag on the Music cog so skip operations call _play_next exactly once, keeping in-memory state consistent with what is actually playing.",
      "passes": true,
      "acceptanceCriteria": [
        "Add _skipping: dict[int, bool] attribute to Music cog",
        "_make_on_track_end callback skips scheduling _play_next when _skipping[guild_id] is True",
        "Discord /skip command sets _skipping flag before vm.stop()",
        "player.py handle_queue_skip sets _skipping flag before vm.stop()",
        "After skip, _current_tracks[guild_id] equals the track actually playing (or None if empty)",
        "Queue reflects remaining tracks correctly after skip",
        "Typecheck/lint passes"
      ]
    },
    {
      "id": "US-002",
      "title": "Verify dashboard stays in sync after skip",
      "description": "As a user, the dashboard shows the correct now-playing song and queue immediately after skipping, whether triggered from Discord or the dashboard.",
      "passes": false,
      "acceptanceCriteria": [
        "After dashboard skip: Now Playing updates to next song (or empty if none remain)",
        "After Discord /skip: next 5-second poll reflects correct now-playing track",
        "If queue has only one song when skip is triggered, dashboard shows empty queue and bot stops playback",
        "Typecheck/lint passes"
      ]
    }
  ]
}
