## Codebase Patterns
- Use `discord.py[voice]>=2.0` (not bare `discord.py>=2.0`) so PyNaCl is installed via the voice extras
- Dockerfile base image is `python:3.12-slim`; must add `libsodium23` to apt-get for PyNaCl native linking
- Tests mock all discord.VoiceClient interactions - no real voice connection needed to run tests
- pyproject.toml uses `setuptools.build_meta` build backend; use `pip install .` (not `-e .`) in Docker
---

# Ralph Progress Log
Started: Fri Feb 27 15:38:49 PST 2026
---

## 2026-02-27 - US-001 / US-002
- Initialized new PRD (prd-fix-pynacl-voice-dependency.md â†’ scripts/prd.json) for PyNaCl missing dependency fix
- US-001: Changed `discord.py>=2.0` to `discord.py[voice]>=2.0` in pyproject.toml to pull in PyNaCl via the voice extras
- US-002: Added `libsodium23` to apt-get install line in Dockerfile alongside ffmpeg
- Files changed: pyproject.toml, Dockerfile, scripts/prd.json, scripts/progress.txt
- **Learnings for future iterations:**
  - The `[voice]` extra on discord.py is the idiomatic way to include PyNaCl; it pins a compatible version automatically
  - `libsodium23` is the correct Debian/Ubuntu package name for the shared library PyNaCl links against
  - All tests use MagicMock for VoiceClient so no actual PyNaCl import is needed at test time
  - US-003 (end-to-end Docker smoke test) requires a running Docker daemon and Discord bot token; cannot be auto-verified in this environment - manual verification needed
---
